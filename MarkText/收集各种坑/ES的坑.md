# ES的坑

## 参考资料

1. [记一次查询优化过程 - 掘金](https://juejin.cn/post/7154821944511037454)

## 坑

1. 现状：使用`ES`查`IP`，总数`700w`量级，单条查询时`10ms`

2. 期望：但是需求变动，需支撑`1000`条批量查，且需`500ms`内完成

3. 结果：在查询`1000`条时，时间大概`5-6s`，显然是不能满足需求

## 解决一

1. 优化代码，做好数据过滤，把不合规的数据过滤掉不进行查询

2. 合并索引，`ES`处进行优化

3. 增加`Redis`缓存

## 解决二

1. 改用`MySQL`，设置好索引即可

2. 自适应`Hash`索引，`B+ tree`会在经常搜索的值里自动建立一个`hash`索引，方便快速查找，这个功能是自动的，当然可以设置关闭

3. 优化后，单个`IP`查询`10us`，`1000`个在`100ms`左右

## 总结

1. `ES`适合大数据查询，模糊搜索

2. `MySQL`可支撑几千万量级，设置好索引，效果还是不错的

3. 针对不同的业务场景选用合适的技术方案，不能为了上架构而上架构


