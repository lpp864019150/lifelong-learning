# 一次偶然机会发现的MySQL“负优化”

## 参考资料

1. [一次偶然机会发现的MySQL“负优化” - 掘金](https://juejin.cn/post/7189834932955381818)

## 坑

1. `order by age limit 1`与`limit 2`差距在`2000`倍

2. 把所有索引都删掉，`limit 2`也只是`1s`左右(在age有索引时为`66s`)，相差`66`倍

## 分析

1. `limit`在查到指定行数时会终止扫描，立即返回

2. 在`order by`和`limit`组合时会优先判断`order by`字段是否有索引，若有则使用该索引而不再考虑其他索引，这里是为了避免`filesort`的产生，这个也是非常耗时

3. 若`order by`字段无索引则是先筛选出所有结果，然后在结果集里进行排序再`limit`截取最终的结果集

4. 在使用索引的过程中若无法满足覆盖索引，则在扫描数据时会频繁回表，每次回表都极有可能是一次随机`IO`

5. 若该索引树基数比较小，极有可能要遍历非常多行甚至扫描整颗索引数才能得到结果，如果每次扫描都需要回表，性能自然比全表扫描还差

6. 全表扫描避免了回表的随机IO，在数据量不是很大的时候性能并不差