# Union性能优化

## 参考博文

1. [优化查询性能：UNION与UNION ALL的区别 - 掘金](https://juejin.cn/post/7266998476134514722)

2. [面渣逆袭：MySQL六十六问，两万字+五十图详解！ - 掘金](https://juejin.cn/post/7111555503301328909#heading-35)

## Union与Union All的区别

1. `Union`不仅会合并结果集，还会对结果集进行排序并去重，最终只保留无重复行的结果集；`Union`会在临时表加上`distinct`选项，用于去重，性能消耗高

2. `Union All`不会对结果集排序，也不会去重，顺序由各子查询顺序决定

3. 从上面的描述看，`Union All`的性能肯定好于`Union`，若我们的结果集里不存在重复行，或者我们不在意重复行，则慎用`Union`

## or优化

1. 众所周知`or`会导致索引失效，此时我们可以考虑使用`union all`来进行优化，把`or`的两端拆分为两个子查询再合并结果集，拆分出来的两个子查询可以分别使用索引

2. 高版本(`>5.0`)已优化，会使用`index_merge`来使用多个索引

## 条件下推

1. 在进行`union all`时，我们可以把全局的`where`、`limit`等子句提前放入对应的子句里，让子句可以使用到索引并且提前减少结果集