# 累签活动礼包码发放异常

## 背景

1. 星辰谷APP里面有一个累签活动，目前已经是第15期累签

2. 累签主要是用户每天打卡签到，签到后领积分，积分可以兑换，比如礼包码或者其他实物

3. 其中礼包码的兑换逻辑大致是这样的：用户用积分兑换，即时扣除积分并告知兑换成功，礼包码异步发放

4. 本次累签有里有一个礼包，用户兑换之后发现礼包码错误，用不了；过了一段时间，还是同一个礼包，又有用户反馈兑换之后一直未收到礼包码

## 分析

1. 查看用户反馈的礼包，发现该礼包有多次上传的记录，其中有一次上传失败

2. 在上传失败与最新一次上传成功之间，也就是用户反馈未收到礼包码的时间段，这里应该是礼包码空了

3. 在前面几次上传成功里，由于运营传错了礼包码，导致那段时间兑换的都是错误的码

4. 运营第一次传错并收到用户反馈礼包码错误时进行了第二次上传，此次上传的为正常码，但是由于里面还有第一次的错误码，导致用户领取的依然为第一次上传的错误码，除非第一次上传的码全部领取完(礼包码发放逻辑为先进先出)

5. 第三次上传失败之前，运营已经知道里面有错误码，于是先做了清空处理，导致码为空，接着上传失败了，也就一直空到又有很多用户反馈未收到码才最后上传了一次，此次上传成功了，后续领取的用户能正常领取到码

6. 由于兑换的礼包码是延迟发放，延迟发放只处理最近2小时的兑换数据，超过时效则不再处理，所以大部分空码的用户依然是空码

7. 延迟发放失败后并不会退回用户的积分

8. 所有异常码需找客服进行补发

9. 客服一般要处理很多用户反馈，不会那么及时处理

10. 很多用户并不会反馈到客服，而是选择发帖骂、评论骂、或者干脆弃游

## 解决

1. 把空码的用户捞出来，然后再逐个进行补发

2. 把错码的用户捞出来，然后再逐个进行补发

3. 补发的同时发送站内信、发送push推送，尽量提醒用户我们已经对码异常的情况进行了补发，安抚用户，让用户使用新的正常的码

4. 同时发布一个公告，告知用户异常码已处理

## 总结

1. 运营侧需加强培训，运营侧的人员变动太快，导致一个运行了15次的活动还能出错，着实不应该

2. 技术侧要加强礼包码不足的预警，并同步反馈给业务、客服，需及时处理

3. 礼包码发放失败后未回退用户积分，导致用户财物两空，此处逻辑可以考虑优化

4. 礼包码上传失败、上传错误，是否可以通过产品侧、技术侧来优化

5. 客服把好最后一道关，若量大，人工处理不来还是需要技术协助
